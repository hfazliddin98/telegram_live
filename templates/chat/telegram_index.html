{% extends 'chat/telegram_base.html' %}

{% block title %}Live Chat{% endblock %}

{% block content %}
{% if not user.is_authenticated %}
    <!-- Login form -->
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c); background-size: 400% 400%; animation: gradient 15s ease infinite;">
        <style>
            @keyframes gradient {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-15px); }
            }
        </style>
        <div style="background: rgba(255,255,255,0.95); backdrop-filter: blur(16px); padding: 48px; border-radius: 24px; box-shadow: 0 30px 80px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255,255,255,0.2); width: 450px; max-width: 90vw;">
            <div style="text-align: center; margin-bottom: 36px;">
                <div style="font-size: 64px; margin-bottom: 20px; animation: float 3s ease-in-out infinite;">ðŸ’¬</div>
                <h1 style="background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 32px; font-weight: 700; margin-bottom: 12px;">Live Chat</h1>
            </div>

            <form method="post" action="{% url 'chat:login' %}">
                {% csrf_token %}
                <div style="margin-bottom: 20px;">
                    <input type="text" 
                           name="username" 
                           placeholder="ðŸ‘¤ Foydalanuvchi nomi" 
                           required
                           style="width: 100%; padding: 18px 20px; background: #f8f9fa; border: 2px solid #e8ecf1; border-radius: 14px; color: #1c1e21; font-size: 16px; transition: all 0.3s ease;"
                           onfocus="this.style.borderColor='#667eea'; this.style.background='#ffffff'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102,126,234,0.15)'"
                           onblur="this.style.borderColor='#e8ecf1'; this.style.background='#f8f9fa'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                </div>
                <div style="margin-bottom: 32px;">
                    <input type="password" 
                           name="password" 
                           placeholder="ðŸ”’ Parol" 
                           required
                           style="width: 100%; padding: 18px 20px; background: #f8f9fa; border: 2px solid #e8ecf1; border-radius: 14px; color: #1c1e21; font-size: 16px; transition: all 0.3s ease;"
                           onfocus="this.style.borderColor='#667eea'; this.style.background='#ffffff'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102,126,234,0.15)'"
                           onblur="this.style.borderColor='#e8ecf1'; this.style.background='#f8f9fa'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                </div>
                <button type="submit" 
                        style="width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 14px; color: #ffffff; font-size: 17px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 25px rgba(102,126,234,0.3);"
                        onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 35px rgba(102,126,234,0.4)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px rgba(102,126,234,0.3)'">
                    ðŸš€ Kirish
                </button>
            </form>
        </div>
    </div>
{% else %}
    <!-- Telegram-style chat interface -->
    {% include 'chat/includes/sidebar.html' %}

    <div class="main-content">
        <div class="chat-header-main">
            <button class="sidebar-toggle-btn" onclick="toggleSidebar()" title="Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="welcome-screen">
            <div class="icon">ðŸ’¬</div>
            <h2>Live Chat ga xush kelibsiz!</h2>
            <p>Chat boshlash uchun chap tarafdan xonani tanlang yoki yangi chat yarating</p>
        </div>
    </div>

    <script>
        // Sidebar toggle function
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const backdrop = document.querySelector('.sidebar-backdrop');
            
            sidebar.classList.toggle('hidden');
            mainContent.classList.toggle('expanded');
            
            // Mobile backdrop toggle
            if (window.innerWidth <= 1024) {
                if (!sidebar.classList.contains('hidden')) {
                    if (!backdrop) {
                        const newBackdrop = document.createElement('div');
                        newBackdrop.className = 'sidebar-backdrop';
                        newBackdrop.onclick = toggleSidebar;
                        document.body.appendChild(newBackdrop);
                        setTimeout(() => newBackdrop.classList.add('active'), 10);
                    } else {
                        backdrop.classList.add('active');
                    }
                } else {
                    if (backdrop) {
                        backdrop.classList.remove('active');
                        setTimeout(() => backdrop.remove(), 300);
                    }
                }
            }
            
            // Save state to localStorage (only for desktop)
            if (window.innerWidth > 1024) {
                const isHidden = sidebar.classList.contains('hidden');
                localStorage.setItem('sidebarHidden', isHidden);
            }
        }
        
        // Restore sidebar state on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Only restore on desktop
            if (window.innerWidth > 1024) {
                const sidebarHidden = localStorage.getItem('sidebarHidden') === 'true';
                if (sidebarHidden) {
                    document.querySelector('.sidebar').classList.add('hidden');
                    document.querySelector('.main-content').classList.add('expanded');
                }
            } else {
                // Mobile: hide sidebar by default
                document.querySelector('.sidebar').classList.add('hidden');
            }
            
            // Handle window resize
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    const backdrop = document.querySelector('.sidebar-backdrop');
                    if (window.innerWidth > 1024 && backdrop) {
                        backdrop.remove();
                    }
                }, 250);
            });
        });
    </script>
{% endif %}
{% endblock %}